<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout(~{::title}, ~{::main}, ~{::script}, 'admin-settings')}">
<head>
    <title>System Settings - DriveSmart</title>
    <th:block th:fragment="head">
        <link rel="stylesheet" href="../main.css">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <!-- NO STYLE TAGS - Using main.css only -->
    </th:block>
</head>
<body>
    <main th:fragment="main-content">
        <div class="container" style="padding: 2rem 1rem;">
            
            <!-- Page Header -->
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 style="font-size: 1.75rem; color: var(--dark); margin-bottom: 0.25rem;">System Settings</h1>
                    <p class="text-secondary">Manage application settings and configuration</p>
                </div>
                <a th:href="@{/admin}" class="btn btn-outline">‚Üê Back to Dashboard</a>
            </div>

            <!-- Settings Tabs Navigation -->
            <div class="card mb-4" style="overflow: hidden;">
                <div style="display: flex; border-bottom: 1px solid var(--border);">
                    <button class="tab-btn active" onclick="showTab('general')" style="flex: 1; padding: 1rem; border: none; background: none; border-bottom: 2px solid var(--cta); color: var(--dark); font-weight: 600;">General</button>
                    <button class="tab-btn" onclick="showTab('notifications')" style="flex: 1; padding: 1rem; border: none; background: none; border-bottom: 1px solid var(--border); color: var(--text-secondary);">Notifications</button>
                    <button class="tab-btn" onclick="showTab('security')" style="flex: 1; padding: 1rem; border: none; background: none; border-bottom: 1px solid var(--border); color: var(--text-secondary);">Security</button>
                    <button class="tab-btn" onclick="showTab('maintenance')" style="flex: 1; padding: 1rem; border: none; background: none; border-bottom: 1px solid var(--border); color: var(--text-secondary);">Maintenance</button>
                </div>
            </div>

            <!-- System Info Card -->
            <div class="card mb-4">
                <h2 style="color: var(--dark); margin-bottom: 1.5rem; font-size: 1.25rem;">System Information</h2>
                
                <div class="grid-4" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="card" style="border: 1px solid var(--border); text-align: center;">
                        <div style="margin-bottom: 0.5rem;"><img src="/images/logov1-removebg-preview.png" alt="App" style="height:24px"></div>
                        <div style="font-weight: 600; color: var(--dark);">Application</div>
                        <div style="color: var(--accent);" th:text="${appName}">DriveSmart</div>
                    </div>
                    
                    <div class="card" style="border: 1px solid var(--border); text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--secondary); margin-bottom: 0.5rem;">üì±</div>
                        <div style="font-weight: 600; color: var(--dark);">Version</div>
                        <div style="color: var(--accent);" th:text="${version}">1.0.0</div>
                    </div>
                    
                    <div class="card" style="border: 1px solid var(--border); text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem;">üíæ</div>
                        <div style="font-weight: 600; color: var(--dark);">Database</div>
                        <div style="color: var(--accent);" th:text="${database}">PostgreSQL</div>
                    </div>
                    
                    <div class="card" style="border: 1px solid var(--border); text-align: center;">
                        <div style="font-size: 1.5rem; color: var(--accent); margin-bottom: 0.5rem;">‚è±Ô∏è</div>
                        <div style="font-weight: 600; color: var(--dark);">Uptime</div>
                        <div style="color: var(--accent);">2 days</div>
                    </div>
                </div>
            </div>

            <!-- General Settings Tab (Active by default) -->
            <div id="general-tab" class="tab-content">
                <div class="card mb-4">
                    <h2 style="color: var(--dark); margin-bottom: 1.5rem; font-size: 1.25rem;">General Settings</h2>
                    
                    <!-- Notification Settings -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--dark); margin-bottom: 1rem; font-size: 1.125rem;">Notifications</h3>
                        
                        <div class="card" style="border: 1px solid var(--border);">
                            <div style="padding: 1rem;">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div style="width: 40px; height: 40px; background: rgba(102, 206, 214, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <span style="color: var(--cta);">üîî</span>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--dark);">Push Notifications</div>
                                            <div class="text-secondary" style="font-size: 0.875rem;">Receive booking alerts and updates</div>
                                        </div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="padding: 1rem; border-top: 1px solid var(--border);">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div style="width: 40px; height: 40px; background: rgba(135, 131, 209, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <span style="color: var(--primary);">üìß</span>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--dark);">Email Notifications</div>
                                            <div class="text-secondary" style="font-size: 0.875rem;">Get reports and system alerts</div>
                                        </div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Appearance Settings -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="color: var(--dark); margin-bottom: 1rem; font-size: 1.125rem;">Appearance</h3>
                        
                        <div class="card" style="border: 1px solid var(--border);">
                            <div style="padding: 1rem;">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div style="width: 40px; height: 40px; background: rgba(93, 112, 127, 0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                            <span style="color: var(--dark);">üåô</span>
                                        </div>
                                        <div>
                                            <div style="font-weight: 600; color: var(--dark);">Dark Mode</div>
                                            <div class="text-secondary" style="font-size: 0.875rem;">Switch to dark theme</div>
                                        </div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="flex justify-end">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
                    </div>
                </div>
            </div>

            <!-- Notifications Settings Tab -->
            <div id="notifications-tab" class="tab-content" style="display: none;">
                <div class="card mb-4">
                    <h2 style="color: var(--dark); margin-bottom: 1.5rem; font-size: 1.25rem;">Notification Settings</h2>
                    
                    <div class="card" style="border: 1px solid var(--border); margin-bottom: 1rem;">
                        <div style="padding: 1.5rem;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Email Frequency</div>
                                <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);">
                                    <option value="daily">Daily Digest</option>
                                    <option value="weekly" selected>Weekly Summary</option>
                                    <option value="monthly">Monthly Report</option>
                                    <option value="instant">Instant Notifications</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Notification Types</div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        <span>New Bookings</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        <span>Booking Updates</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" style="width: 18px; height: 18px;">
                                        <span>Marketing Emails</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        <span>System Alerts</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Notification Settings</button>
                    </div>
                </div>
            </div>

            <!-- Security Settings Tab -->
            <div id="security-tab" class="tab-content" style="display: none;">
                <div class="card mb-4">
                    <h2 style="color: var(--dark); margin-bottom: 1.5rem; font-size: 1.25rem;">Security Settings</h2>
                    
                    <div class="card" style="border: 1px solid var(--border); margin-bottom: 1rem;">
                        <div style="padding: 1.5rem;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Session Timeout</div>
                                <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);">
                                    <option value="15">15 minutes</option>
                                    <option value="30" selected>30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="120">2 hours</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Password Policy</div>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        <span>Require special characters</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked style="width: 18px; height: 18px;">
                                        <span>Minimum 8 characters</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" style="width: 18px; height: 18px;">
                                        <span>Password expiration (90 days)</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end">
                        <button class="btn btn-primary" onclick="saveSettings()">Save Security Settings</button>
                    </div>
                </div>
            </div>

            <!-- Maintenance Settings Tab -->
            <div id="maintenance-tab" class="tab-content" style="display: none;">
                <div class="card mb-4">
                    <h2 style="color: var(--dark); margin-bottom: 1.5rem; font-size: 1.25rem;">System Maintenance</h2>
                    
                    <div class="card" style="border: 1px solid var(--border); margin-bottom: 1.5rem;">
                        <div style="padding: 1.5rem;">
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Backup Frequency</div>
                                <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.5rem;">Log Retention</div>
                                <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);">
                                    <option value="30">30 days</option>
                                    <option value="90" selected>90 days</option>
                                    <option value="365">1 year</option>
                                    <option value="forever">Forever</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-outline" style="width: 100%; margin-top: 1rem;">Backup Now</button>
                        </div>
                    </div>
                    
                    <!-- Danger Zone -->
                    <div class="card" style="border: 2px solid #dc3545;">
                        <div style="padding: 1.5rem;">
                            <h3 style="color: #dc3545; margin-bottom: 1rem; font-size: 1.125rem;">‚ö†Ô∏è Danger Zone</h3>
                            
                            <div style="margin-bottom: 1rem;">
                                <div class="text-secondary" style="margin-bottom: 0.5rem;">Reset all system settings to default values.</div>
                                <button class="btn" style="background: #dc3545; color: white; border: none; width: 100%;" 
                                        onclick="confirmReset()">
                                    Emergency System Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <th:block th:fragment="scripts">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize toggle switches
                document.querySelectorAll('.toggle-switch').forEach(toggle => {
                    const input = toggle.querySelector('input[type="checkbox"]');
                    const slider = toggle.querySelector('.toggle-slider');
                    
                    // Create toggle switch styles
                    toggle.style.position = 'relative';
                    toggle.style.display = 'inline-block';
                    toggle.style.width = '52px';
                    toggle.style.height = '28px';
                    
                    slider.style.position = 'absolute';
                    slider.style.cursor = 'pointer';
                    slider.style.top = '0';
                    slider.style.left = '0';
                    slider.style.right = '0';
                    slider.style.bottom = '0';
                    slider.style.backgroundColor = '#ccc';
                    slider.style.transition = '.4s';
                    slider.style.borderRadius = '34px';
                    
                    slider.style.setProperty('before', 'content: ""; position: absolute; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%;');
                    
                    input.style.display = 'none';
                    
                    // Add click handler
                    toggle.addEventListener('click', function() {
                        input.checked = !input.checked;
                        updateToggle(this);
                    });
                    
                    // Initial state
                    updateToggle(toggle);
                });
                
                function updateToggle(toggle) {
                    const input = toggle.querySelector('input[type="checkbox"]');
                    const slider = toggle.querySelector('.toggle-slider');
                    
                    if (input.checked) {
                        slider.style.backgroundColor = 'var(--cta)';
                        slider.style.setProperty('before', 'transform: translateX(24px)');
                    } else {
                        slider.style.backgroundColor = '#ccc';
                        slider.style.setProperty('before', 'transform: translateX(0)');
                    }
                }
                
                // Tab switching
                window.showTab = function(tabName) {
                    // Hide all tabs
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.style.display = 'none';
                    });
                    
                    // Remove active class from all tab buttons
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.style.borderBottom = '1px solid var(--border)';
                        btn.style.color = 'var(--text-secondary)';
                        btn.style.borderBottomColor = 'var(--border)';
                        btn.classList.remove('active');
                    });
                    
                    // Show selected tab
                    document.getElementById(tabName + '-tab').style.display = 'block';
                    
                    // Activate selected tab button
                    const activeBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
                        btn.textContent.trim().toLowerCase() === tabName.toLowerCase() || 
                        btn.getAttribute('onclick')?.includes(tabName)
                    );
                    
                    if (activeBtn) {
                        activeBtn.style.borderBottom = '2px solid var(--cta)';
                        activeBtn.style.color = 'var(--dark)';
                        activeBtn.style.fontWeight = '600';
                        activeBtn.classList.add('active');
                    }
                };
                
                // Settings save function
                window.saveSettings = function() {
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: var(--cta);
                        color: white;
                        padding: 1rem 1.5rem;
                        border-radius: 0.5rem;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        z-index: 1000;
                        animation: slideIn 0.3s ease;
                    `;
                    
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    toast.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>‚úÖ</span>
                            <span>Settings saved successfully!</span>
                        </div>
                    `;
                    
                    document.body.appendChild(toast);
                    
                    // Remove toast after 3 seconds
                    setTimeout(() => {
                        toast.style.animation = 'slideOut 0.3s ease';
                        toast.style.transform = 'translateX(100%)';
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                    
                    console.log('Settings saved');
                };
                
                // System reset confirmation
                window.confirmReset = function() {
                    if (confirm('‚ö†Ô∏è WARNING: This will reset ALL system settings to default values. This action cannot be undone. Are you sure?')) {
                        alert('System reset initiated. This may take a few moments...');
                        console.log('Performing system reset...');
                        // Add actual reset logic here
                    }
                };
            });
        </script>
    </th:block>
</body>
</html>
