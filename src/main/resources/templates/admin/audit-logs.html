<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout(~{::title}, ~{::main}, ~{::script}, 'admin')}">
<head>
    <title>Audit Logs - DriveSmart Admin</title>
</head>
<body>
    <main th:fragment="main-content">
        <div class="container" style="padding: 2rem 1rem;">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 style="font-size: 1.75rem; color: var(--dark); margin-bottom: 0.25rem;">Audit Logs</h1>
                    <p class="text-secondary">System events and administrative actions</p>
                </div>
                <a th:href="@{/admin}" class="btn btn-outline">‚Üê Back to Dashboard</a>
            </div>

            <div class="card mb-4">
                <div class="flex gap-3 flex-wrap" style="padding: 1rem;">
                    <div style="flex: 1; min-width: 250px;">
                        <input type="text" class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);" 
                               id="search" placeholder="Search by user, action or details...">
                    </div>
                    
                    <select class="card" style="padding: 0.75rem; border: 1px solid var(--border); min-width: 150px;" 
                            id="severity">
                        <option value="all">All Severities</option>
                        <option value="SUCCESS">Success</option>
                        <option value="WARNING">Warning</option>
                        <option value="ERROR">Error</option>
                    </select>
                </div>
            </div>

            <div class="card mb-4" style="overflow: hidden;">
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; min-width: 800px;">
                        <thead>
                            <tr style="background: var(--bg-secondary); border-bottom: 2px solid var(--border);">
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: var(--dark);">Timestamp</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: var(--dark);">User</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: var(--dark);">Action</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: var(--dark);">Details</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600; color: var(--dark);">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${logs == null} || ${#lists.isEmpty(logs)}">
                                <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                    <div style="margin-bottom: 1rem;">üìä</div>
                                    <div>No audit logs available</div>
                                </td>
                            </tr>
                            
                            <tr th:each="log : ${logs}" class="log-row">
                                <td style="padding: 1rem; border-bottom: 1px solid var(--border); color: var(--dark);">
                                    <div th:text="${log.timestamp}">2025-01-01 10:00:00</div>
                                </td>
                                <td style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                    <div style="font-weight: 500; color: var(--dark);" th:text="${log.user}">admin@drivesmart.com</div>
                                </td>
                                <td style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                    <div style="font-weight: 500; color: var(--dark);" th:text="${log.action}">UPDATE_SETTINGS</div>
                                </td>
                                <td style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                    <div style="color: var(--text-secondary); max-width: 300px; word-wrap: break-word;" 
                                         th:text="${log.details}">Changed session timeout to 30 minutes</div>
                                </td>
                                <td style="padding: 1rem; border-bottom: 1px solid var(--border);">
                                    <span th:if="${log.level == 'SUCCESS'}" 
                                          style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(25, 135, 84, 0.1); color: #198754; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                        SUCCESS
                                    </span>
                                    <span th:if="${log.level == 'WARNING'}" 
                                          style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(255, 193, 7, 0.1); color: #ffc107; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                        WARNING
                                    </span>
                                    <span th:if="${log.level == 'ERROR'}" 
                                          style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(220, 53, 69, 0.1); color: #dc3545; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                        ERROR
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <th:block th:fragment="scripts">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const searchInput = document.getElementById('search');
                const severityFilter = document.getElementById('severity');
                const logRows = document.querySelectorAll('.log-row');
                
                function filterLogs() {
                    const searchTerm = (searchInput.value || '').toLowerCase();
                    const selectedSeverity = severityFilter.value;
                    
                    logRows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const statusBadge = row.querySelector('span');
                        const level = statusBadge ? statusBadge.textContent.trim() : '';
                        
                        const matchesSearch = !searchTerm || text.includes(searchTerm);
                        const matchesSeverity = selectedSeverity === 'all' || level === selectedSeverity;
                        
                        row.style.display = (matchesSearch && matchesSeverity) ? '' : 'none';
                    });
                }
                
                if (searchInput) searchInput.addEventListener('input', filterLogs);
                if (severityFilter) severityFilter.addEventListener('change', filterLogs);
            });
        </script>
    </th:block>
</body>
</html>
