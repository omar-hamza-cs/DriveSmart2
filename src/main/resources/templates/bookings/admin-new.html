<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: layout(~{::title}, ~{::main}, ~{::scripts}, 'bookings')}">
<head>
    <title>Create Booking (Admin) - DriveSmart</title>
</head>
<body>
    <main th:fragment="main-content">
        <div style="min-height: 100vh; background: linear-gradient(135deg, rgba(167,165,198,0.08), rgba(102,206,214,0.08)); padding: 2rem 1rem;">
            <div class="container" style="max-width: 800px;">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h1 style="font-size: 1.75rem; color: var(--dark); margin-bottom: 0.25rem;">Create Booking for Client</h1>
                        <p class="text-secondary">Admin: Create a booking on behalf of a customer</p>
                    </div>
                    <a th:href="@{/bookings}" class="btn btn-outline">← Back to Bookings</a>
                </div>

                <div th:if="${error}" class="card mb-4" style="background: rgba(220, 53, 69, 0.1); border-color: #dc3545;">
                    <div class="flex items-center gap-2" style="color: #dc3545;">
                        <span>⚠️</span>
                        <span th:text="${error}"></span>
                    </div>
                </div>
                <div th:if="${success}" class="card mb-4" style="background: rgba(25, 135, 84, 0.1); border-color: #198754;">
                    <div class="flex items-center gap-2" style="color: #198754;">
                        <span>✅</span>
                        <span th:text="${success}"></span>
                    </div>
                </div>

                <div class="card mb-4">
                    <form th:action="@{/bookings/admin/create}" method="post" onsubmit="return validateAdminBookingForm()">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">Select Client *</label>
                            <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);" 
                                    name="clientId" required>
                                <option value="">Choose a client...</option>
                                <option th:each="client : ${clients}" 
                                        th:value="${client.id}"
                                        th:selected="${selectedClientId} == ${client.id}"
                                        th:text="${client.fullName + ' (' + client.email + ')'}">
                                </option>
                            </select>
                            <div th:if="${#lists.isEmpty(clients)}" class="mt-2">
                                <a th:href="@{/customers/add}" class="btn btn-outline">➕ Add a customer</a>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">Select Car *</label>
                            <select class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);" 
                                    name="carId" required>
                                <option value="">Choose a car...</option>
                                <option th:each="car : ${cars}" 
                                        th:value="${car.id}"
                                        th:text="${car.brand + ' ' + car.model + ' - $' + car.pricePerDay + '/day'}">
                                </option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: var(--dark); margin-bottom: 1rem; font-size: 1.125rem;">Booking Dates</h3>
                            
                            <div class="grid-4" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">Pick-up Date *</label>
                                    <input type="date" class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);" 
                                           name="startDate" th:min="${minDate}" required>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark);">Return Date *</label>
                                    <input type="date" class="card" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border);" 
                                           name="endDate" th:min="${minDate}" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between gap-2 mt-4" style="border-top: 1px solid var(--border); padding-top: 1.5rem;">
                            <a th:href="@{/bookings}" class="btn btn-outline">Cancel</a>
                            <button type="submit" class="btn btn-primary">Create Booking</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <th:block th:fragment="scripts">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const startDateInput = document.querySelector('input[name="startDate"]');
                const endDateInput = document.querySelector('input[name="endDate"]');
                
                if (startDateInput && endDateInput) {
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const tomorrowStr = tomorrow.toISOString().split('T')[0];
                    
                    if (!startDateInput.value) {
                        startDateInput.value = tomorrowStr;
                    }
                    
                    startDateInput.addEventListener('change', function() {
                        if (this.value) {
                            const minEndDate = new Date(this.value);
                            minEndDate.setDate(minEndDate.getDate() + 1);
                            endDateInput.min = minEndDate.toISOString().split('T')[0];
                        }
                    });
                    
                    startDateInput.dispatchEvent(new Event('change'));
                }
            });

            function validateAdminBookingForm() {
                const clientSel = document.querySelector('select[name="clientId"]');
                const carSel = document.querySelector('select[name="carId"]');
                const start = document.querySelector('input[name="startDate"]');
                const end = document.querySelector('input[name="endDate"]');
                if (!clientSel.value || !carSel.value || !start.value || !end.value) {
                    alert('Please select client, car, and both dates');
                    return false;
                }
                return true;
            }
        </script>
    </th:block>
</body>
</html>
